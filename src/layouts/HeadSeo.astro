---

import { SITE_METADATA } from '@/consts'

interface Props {
  title?: string
  description?: string
  image?: string
  type?: 'website' | 'article'
  keywords?: string
  author?: string
  publishedTime?: string
  modifiedTime?: string
  noindex?: boolean
  nofollow?: boolean
  schema?: Record<string, any>
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const {
  title,
  description,
  image,
  type = 'website',
  keywords,
  author,
  publishedTime,
  modifiedTime,
  noindex = false,
  nofollow = false,
  schema
} = Astro.props

// Use site metadata defaults if not provided
const finalTitle = title ? `${title} | YOKESH | Shadcn Studio` : SITE_METADATA.title.default
const finalDescription = description || SITE_METADATA.description
const finalKeywords = keywords || SITE_METADATA.keywords.join(', ')
const finalImage = image || SITE_METADATA.openGraph.images[0].url
const imageURL = new URL(finalImage, Astro.site)
const finalAuthor = author || SITE_METADATA.authors[0].name

// Robots meta tag
const robotsContent = `${noindex || !SITE_METADATA.robots.index ? 'noindex' : 'index'}, ${nofollow || !SITE_METADATA.robots.follow ? 'nofollow' : 'follow'}, max-image-preview:large, max-snippet:-1, max-video-preview:-1`

// Default schema.org structured data
const defaultSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE_METADATA.openGraph.siteName,
  url: Astro.site?.toString(),
  description: finalDescription,
  inLanguage: SITE_METADATA.language.split('-')[0],
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${Astro.site}search?q={search_term_string}`
    },
    'query-input': 'required name=search_term_string'
  }
}

const schemaData = schema || defaultSchema
---

<!-- Essential Meta Tags -->
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover' />
<meta name='generator' content={Astro.generator} />
<meta http-equiv='X-UA-Compatible' content='IE=edge' />

<!-- Primary Meta Tags -->
<title>{finalTitle}</title>
<meta name='title' content={finalTitle} />
<meta name='description' content={finalDescription} />
<meta name='keywords' content={finalKeywords} />
<meta name='author' content={finalAuthor} />
<meta name='creator' content={SITE_METADATA.creator} />
<meta name='publisher' content={SITE_METADATA.publisher} />

<!-- Canonical URL -->
<link rel='canonical' href={canonicalURL} />

<!-- Robots Meta Tags -->
<meta name='robots' content={robotsContent} />
<meta name='googlebot' content={robotsContent} />
<meta name='bingbot' content={robotsContent} />

<!-- Sitemap -->
<link rel='sitemap' href='/sitemap-index.xml' />

<!-- Verification (if provided) -->
{
  SITE_METADATA.verification.google && (
    <meta name='google-site-verification' content={SITE_METADATA.verification.google} />
  )
}
{SITE_METADATA.verification.bing && <meta name='msvalidate.01' content={SITE_METADATA.verification.bing} />}
{SITE_METADATA.verification.yandex && <meta name='yandex-verification' content={SITE_METADATA.verification.yandex} />}

<!-- Language and Locale -->
<meta property='og:locale' content={SITE_METADATA.locale} />
<meta http-equiv='content-language' content={SITE_METADATA.language} />

<!-- Favicon and Icons -->
{SITE_METADATA.icons.icon.map(icon => <link rel='icon' type={icon.type} sizes={icon.sizes} href={icon.url} />)}
{SITE_METADATA.icons.apple.map(icon => <link rel='apple-touch-icon' sizes={icon.sizes} href={icon.url} />)}
{SITE_METADATA.icons.shortcut.map(icon => <link rel='shortcut icon' href={icon.url} />)}
<link rel='manifest' href='/site.webmanifest' />

<!-- Sitemap -->
<link rel='sitemap' href='/sitemap.xml' />

<!-- RSS Feed -->
<link
  rel='alternate'
  type='application/rss+xml'
  title={`${SITE_METADATA.title.default} RSS Feed`}
  href={new URL('rss.xml', Astro.site)}
/>

<!-- Open Graph / Facebook -->
<meta property='og:type' content={type} />
<meta property='og:url' content={canonicalURL} />
<meta property='og:site_name' content={SITE_METADATA.openGraph.siteName} />
<meta property='og:title' content={title || SITE_METADATA.openGraph.title} />
<meta property='og:description' content={finalDescription} />
<meta property='og:image' content={imageURL} />
<meta property='og:image:url' content={imageURL} />
<meta property='og:image:secure_url' content={imageURL} />
<meta property='og:image:width' content={SITE_METADATA.openGraph.images[0].width.toString()} />
<meta property='og:image:height' content={SITE_METADATA.openGraph.images[0].height.toString()} />
<meta property='og:image:alt' content={title || SITE_METADATA.openGraph.images[0].alt} />
<meta property='og:image:type' content={SITE_METADATA.openGraph.images[0].type} />
{publishedTime && <meta property='article:published_time' content={publishedTime} />}
{modifiedTime && <meta property='article:modified_time' content={modifiedTime} />}
{author && <meta property='article:author' content={author} />}
{type === 'article' && keywords && keywords.split(',').map(tag => <meta property='article:tag' content={tag.trim()} />)}

<!-- Twitter -->
<meta name='twitter:card' content={SITE_METADATA.twitter.card} />
<meta name='twitter:site' content={SITE_METADATA.twitter.site} />
<meta name='twitter:creator' content={SITE_METADATA.twitter.creator} />
<meta name='twitter:title' content={title || SITE_METADATA.twitter.title} />
<meta name='twitter:description' content={finalDescription} />
<meta name='twitter:image' content={imageURL} />
<meta name='twitter:image:alt' content={title || SITE_METADATA.openGraph.images[0].alt} />
<meta property='twitter:url' content={canonicalURL} />

<!-- Performance and Resource Hints -->
<link rel='dns-prefetch' href='https://fonts.googleapis.com' />
<link rel='preconnect' href='https://fonts.googleapis.com' />
<link rel='preconnect' href='https://fonts.gstatic.com' crossorigin='anonymous' />
<!-- Google Fonts - Optimized Loading -->
<link
  rel='preload'
  as='style'
  href='https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Outfit:wght@100..900&display=swap'
/>
<link
  href='https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Kaushan+Script&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Outfit:wght@100..900&display=swap'
  rel='stylesheet'
  media='print'
  onload="this.media='all'"
/>

<!-- Theme Color -->
<meta name='theme-color' content='#ffffff' media='(prefers-color-scheme: light)' />
<meta name='theme-color' content='#0a0a0a' media='(prefers-color-scheme: dark)' />

<!-- Structured Data (JSON-LD) -->
{/* eslint-disable-next-line astro/no-set-html-directive */}
<script type='application/ld+json' set:html={JSON.stringify(schemaData)} />
