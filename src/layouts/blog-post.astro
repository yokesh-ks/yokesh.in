---
import { buttonVariants } from '@/components/ui/button'
import { siteConfig } from '@/config/site'
import { cn, formatDate } from '@/lib/utils'
import type { CollectionEntry } from 'astro:content'
import MainLayout from './main-layout.astro'

type Props = CollectionEntry<'blog'>

const slug = Astro.props.id
const { title, description, pubDate, updatedDate, coverImage, category, ogImage, keywords } =
  Astro.props.data

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': `${siteConfig.url}/blog/${slug}`
  },
  headline: title,
  image: ogImage,
  author: {
    '@type': 'Person',
    name: 'Yokesh K.S.',
    url: siteConfig.url
  },
  publisher: {
    '@type': 'Person',
    name: 'Yokesh K.S.'
  },
  datePublished: pubDate.toISOString(),
  dateModified: updatedDate ? updatedDate.toISOString() : pubDate.toISOString(),
  description: description
}

const breadcrumbLd = {
  '@context': 'https://schema.org/',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: siteConfig.url },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: `${siteConfig.url}/blog` },
    { '@type': 'ListItem', position: 3, name: title, item: `${siteConfig.url}/blog/${slug}` }
  ]
}
---

<MainLayout title={title} description={description} image={ogImage} keywords={keywords}>
  <!-- Hero Section -->
  <section class="relative overflow-hidden pb-8 pt-16 lg:py-20">
    <div
      class="absolute inset-0 bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-900 dark:to-indigo-950"
    >
    </div>

    <div class="container relative z-10 max-w-4xl">
      <!-- Back Navigation -->
      <div class="mb-8">
        <a
          href="/blog"
          class={cn(
            buttonVariants({ variant: 'ghost', size: 'sm' }),
            'text-muted-foreground hover:text-foreground transition-colors duration-300 group'
          )}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="mr-2 group-hover:-translate-x-1 transition-transform duration-300"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
          Back to Blog
        </a>
      </div>

      <!-- Article Header -->
      <div class="text-center mb-12">
        <h1
          class="font-heading text-3xl font-bold sm:text-4xl md:text-5xl !leading-[1.1] mb-6"
          transition:name={'title-' + slug}
        >
          {title}
        </h1>

        <p class="text-lg text-muted-foreground max-w-2xl mx-auto leading-relaxed mb-8">
          {description}
        </p>

        <!-- Article Meta -->
        <div
          class="flex flex-wrap items-center justify-center gap-4 text-sm text-muted-foreground"
        >
          <div class="flex items-center gap-2">
            <div
              class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xs font-bold"
            >
              YK
            </div>
            <span>Yokesh K S</span>
          </div>
          <div class="w-1 h-1 bg-muted-foreground rounded-full"></div>
          <time datetime={pubDate.toISOString()} transition:name={'date-' + slug}>
            {formatDate(pubDate)}
          </time>
          {
            updatedDate && (
              <>
                <div class="w-1 h-1 bg-muted-foreground rounded-full" />
                <span>Updated {formatDate(updatedDate)}</span>
              </>
            )
          }
        </div>
      </div>

      <!-- Featured Image -->
      <div class="relative mb-12 group">
        <div
          class="absolute -inset-4 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"
        >
        </div>
        <img
          class="relative rounded-2xl overflow-hidden shadow-2xl w-full h-auto border border-gray-200 dark:border-gray-700"
          width="1020"
          height="510"
          src={coverImage}
          alt={title}
          loading="lazy"
          transition:name={'img-' + slug}
        />
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <section
    class="py-8 "
  >
    <div class="container max-w-4xl">
      <div class="relative">
        <article
          class="prose prose-lg dark:prose-invert max-w-none prose-headings:font-heading prose-a:text-indigo-600 dark:prose-a:text-indigo-400 prose-a:no-underline hover:prose-a:underline prose-code:bg-gray-100 dark:prose-code:bg-gray-800 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-pre:bg-gray-900 dark:prose-pre:bg-gray-950 prose-pre:border prose-pre:border-gray-200 dark:prose-pre:border-gray-700 prose-blockquote:border-l-indigo-500 prose-blockquote:bg-indigo-50 dark:prose-blockquote:bg-indigo-950/30 prose-blockquote:px-6 prose-blockquote:py-4 prose-blockquote:rounded-r-lg"
        >
          <slot />
        </article>
      </div>
    </div>
  </section>
</MainLayout>

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbLd)} />
