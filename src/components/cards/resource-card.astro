---
import { Card, CardContent } from '@/components/ui/card'
import { Separator } from '@/components/ui/separator'
import { addUtmParams } from '@/lib/utils'
import type { ResourceItem } from '@/assets/data/resources'

interface Props {
  item: ResourceItem
}

const { item } = Astro.props

const getDomain = (url: string) => {
  try {
    return new URL(`https://${url}`).hostname.replace('www.', '')
  } catch {
    return url
  }
}

const getFaviconUrl = (domain: string) => {
  return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`
}

const domain = getDomain(item.link)
---

<a href={addUtmParams(item.link)} target="_blank" rel="noopener noreferrer" class="block">
  <Card className="overflow-hidden rounded-none py-0 shadow-none transition-colors duration-300 hover:border-primary h-full">
    <CardContent className="px-0">
      <div class="flex items-center gap-3 px-6 pt-5 pb-3">
        {item.imageUrl ? (
          <img
            src={item.imageUrl}
            alt={`${item.label} icon`}
            class="h-8 w-8 shrink-0 object-contain"
            loading="lazy"
          />
        ) : (
          <img
            src={getFaviconUrl(domain)}
            alt={`${item.label} favicon`}
            class="h-8 w-8 shrink-0 object-contain"
            loading="lazy"
          />
        )}
        <div class="min-w-0 flex-1">
          <p class="font-semibold text-lg leading-none">{item.label}</p>
          <p class="mt-1 text-sm text-muted-foreground">{domain}</p>
        </div>
        <svg
          class="h-4 w-4 shrink-0 text-muted-foreground"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
          />
        </svg>
      </div>
      <div class="px-6 pb-5">
        <Separator />
        <p class="mt-3 text-sm text-muted-foreground line-clamp-2">{item.description}</p>
      </div>
    </CardContent>
  </Card>
</a>
